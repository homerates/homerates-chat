<!-- index.html (root) — COMPLETE FILE, ready to paste. ChatGPT-style UI, no frameworks. -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HomeRates Chat</title>
  <style>
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body { margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; color: #111; background: #f5f5f5; }

    :root {
      --border: #e6e6e6;
      --muted: #6b7280;
      --bg: #ffffff;
      --bg-subtle: rgba(255,255,255,0.85);
      --shadow: 0 1px 2px rgba(0,0,0,0.04);
      --assistant: #ffffff;
      --assistant-border: #e5e7eb;
      --user: #111111;
      --user-text: #ffffff;
    }

    .app { display: flex; height: 100dvh; width: 100%; overflow: hidden; }

    /* Sidebar */
    .sidebar { width: 288px; background: var(--bg); border-right: 1px solid var(--border); display: flex; flex-direction: column; }
    .sidebar__header { display: flex; align-items: center; gap: 8px; padding: 10px 12px; border-bottom: 1px solid var(--border); }
    .badge { width: 20px; height: 20px; border-radius: 50%; background: #111; }
    .brand { font-weight: 600; }
    .sidebar__sectionLabel { padding: 12px; font-size: 11px; text-transform: uppercase; letter-spacing: .06em; color: var(--muted); }
    .sidebar__nav { padding: 0 8px 8px; display: grid; gap: 6px; }
    .sidebar__item { text-align: left; padding: 10px 12px; border-radius: 10px; border: 1px solid transparent; background: transparent; cursor: pointer; font-size: 14px; color: #111; text-decoration: none; }
    .sidebar__item:hover { background: #f3f4f6; }
    .sidebar__footer { margin-top: auto; padding: 10px 12px; font-size: 12px; color: var(--muted); border-top: 1px solid var(--border); }

    /* Chat column */
    .chat { position: relative; flex: 1; background: #fafafa; }
    .messages { position: absolute; inset: 0 0 calc(80px + env(safe-area-inset-bottom)) 0; overflow-y: auto; padding: 8px 12px; }
    .messages__inner { max-width: 768px; margin: 0 auto; padding: 6px 6px 24px; }

    /* Message row */
    .msgRow { display: flex; gap: 12px; padding: 10px 0; align-items: flex-start; }
    .avatar { width: 28px; height: 28px; border-radius: 50%; margin-top: 2px; flex: 0 0 auto; }
    .avatar--assistant { background: #111; }
    .avatar--user { background: #d1d5db; }
    .bubble { max-width: 85%; padding: 12px 14px; border-radius: 16px; box-shadow: var(--shadow); font-size: 15px; line-height: 1.5; }
    .bubble--assistant { background: var(--assistant); border: 1px solid var(--assistant-border); }
    .bubble--user { background: var(--user); color: var(--user-text); margin-left: auto; }

    /* Jump to latest */
    .jump { position: absolute; right: 16px; bottom: calc(96px + env(safe-area-inset-bottom)); border: 1px solid var(--border); background: var(--bg-subtle); padding: 6px 10px; border-radius: 999px; font-size: 13px; box-shadow: var(--shadow); display: none; }
    .jump.show { display: inline-block; }
    .jump:hover { background: #fff; }

    /* Composer */
    .composer { position: absolute; left: 0; right: 0; bottom: 0; border-top: 1px solid var(--border); background: var(--bg-subtle); backdrop-filter: saturate(1.1) blur(6px); }
    .composer__inner { max-width: 768px; margin: 10px auto 2px; display: flex; align-items: flex-end; gap: 8px; padding: 8px 10px; border: 1px solid var(--border); border-radius: 16px; background: #fff; box-shadow: var(--shadow); }
    .composer__input { flex: 1; min-height: 40px; max-height: 168px; border: none; outline: none; resize: none; padding: 8px 10px; font-size: 15px; line-height: 24px; background: transparent; }
    .composer__send { border: 1px solid var(--border); background: #f3f4f6; border-radius: 12px; padding: 8px 12px; font-size: 14px; color: #6b7280; cursor: pointer; }
    .composer__send--ready { background: #111; color: #fff; border-color: #111; }
    .composer__note { max-width: 768px; margin: 4px auto 10px; padding: 0 10px; font-size: 11px; color: var(--muted); }

    /* Responsive: collapse sidebar on small screens */
    @media (max-width: 1024px) {
      .sidebar { display: none; }
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- Sidebar (left column) -->
    <aside class="sidebar">
      <div class="sidebar__header">
        <div class="badge" aria-hidden="true"></div>
        <div class="brand">HomeRates.ai</div>
      </div>

      <div class="sidebar__sectionLabel">Conversations</div>
      <nav class="sidebar__nav" id="convNav">
        <button class="sidebar__item" type="button">New chat</button>
        <button class="sidebar__item" type="button">Access Zero options</button>
        <button class="sidebar__item" type="button">Seller credit vs price cut</button>
        <button class="sidebar__item" type="button">Jumbo eligibility (H‑1B)</button>
      </nav>

      <div class="sidebar__sectionLabel">Quick links</div>
      <nav class="sidebar__nav">
        <a class="sidebar__item" href="/">Ask Anything</a>
        <a class="sidebar__item" href="https://homerates.ai/knowledge">Knowledge Hub</a>
        <a class="sidebar__item" href="https://homerates.ai/market-news">Market News</a>
      </nav>

      <div class="sidebar__footer">NMLS #366082 · CA Only</div>
    </aside>

    <!-- Main chat (right column) -->
    <main class="chat">
      <!-- Scrollable messages area; padded at bottom to clear composer -->
      <div class="messages" id="messages">
        <div class="messages__inner" id="messagesInner"></div>
      </div>

      <!-- Jump to latest -->
      <button class="jump" id="jumpBtn" type="button">Jump to latest</button>

      <!-- Sticky composer -->
      <div class="composer">
        <div class="composer__inner">
          <textarea id="composerInput" class="composer__input" placeholder="Message HomeRates.ai" rows="1" spellcheck="false"></textarea>
          <button id="sendBtn" type="button" class="composer__send">Send</button>
        </div>
        <div class="composer__note">HomeRates.ai can make mistakes. Verify critical numbers.</div>
      </div>
    </main>
  </div>

  <script>
    // ===== Simple, framework-free chat UI =====
    const messagesEl = document.getElementById('messages');
    const messagesInnerEl = document.getElementById('messagesInner');
    const inputEl = document.getElementById('composerInput');
    const sendBtn = document.getElementById('sendBtn');
    const jumpBtn = document.getElementById('jumpBtn');

    let atBottom = true;
    const messages = [
      { role: 'assistant', content: 'Welcome to HomeRates.ai — ask anything about buying, refinancing, or strategy. I\'ll keep it plain and useful.' },
      { role: 'user', content: 'What\'s the difference between a 2/1 buydown and a price cut?' },
      { role: 'assistant', content: 'Short version: a 2/1 targets payment timing without lowering basis; price cuts lower basis. Want numbers on your range?' },
    ];

    function el(tag, cls, text) {
      const node = document.createElement(tag);
      if (cls) node.className = cls;
      if (text != null) node.textContent = text;
      return node;
    }

    function renderMessages() {
      messagesInnerEl.innerHTML = '';
      for (const m of messages) {
        const row = el('div', 'msgRow');
        const avatar = el('div', 'avatar ' + (m.role === 'assistant' ? 'avatar--assistant' : 'avatar--user'));
        const bubble = el('div', 'bubble ' + (m.role === 'assistant' ? 'bubble--assistant' : 'bubble--user'));
        bubble.textContent = m.content;
        row.appendChild(avatar);
        row.appendChild(bubble);
        messagesInnerEl.appendChild(row);
      }
      if (atBottom) scrollToBottom(false);
    }

    function scrollToBottom(smooth = true) {
      const behavior = smooth ? 'smooth' : 'auto';
      messagesEl.scrollTo({ top: messagesEl.scrollHeight, behavior });
    }

    function updateJump() {
      jumpBtn.classList.toggle('show', !atBottom);
    }

    messagesEl.addEventListener('scroll', () => {
      const tol = 24;
      atBottom = (messagesEl.scrollHeight - messagesEl.scrollTop - messagesEl.clientHeight) < tol;
      updateJump();
    });

    function autosize() {
      inputEl.style.height = 'auto';
      const line = 24; // approx line-height
      const max = line * 6 + 12; // up to ~6 lines
      inputEl.style.height = Math.min(inputEl.scrollHeight, max) + 'px';
    }
    inputEl.addEventListener('input', autosize);

    inputEl.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        handleSend();
      }
    });

    sendBtn.addEventListener('click', handleSend);

    async function handleSend() {
      const text = inputEl.value.trim();
      if (!text) return;
      inputEl.value = '';
      autosize();
      sendBtn.disabled = true;

      // Add user message
      messages.push({ role: 'user', content: text });
      renderMessages();

      // Add assistant placeholder
      const placeholder = { role: 'assistant', content: '' };
      messages.push(placeholder);
      renderMessages();

      try {
        // ==== THIS IS THE FETCH CALL YOU ASKED TO BE INCLUDED (full context) ====
        const res = await fetch('/api/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message: text })
        });
        const data = await res.json();
        const reply = data && data.reply ? data.reply : 'I hit a snag. Try again.';

        // Fake typing effect for nicer feel
        await typeIntoPlaceholder(placeholder, reply);
      } catch (err) {
        placeholder.content = 'Network hiccup. Mind sending that again?';
        renderMessages();
      } finally {
        sendBtn.disabled = false;
        scrollToBottom(true);
      }
    }

    function delay(ms) { return new Promise(r => setTimeout(r, ms)); }

    async function typeIntoPlaceholder(placeholder, text) {
      placeholder.content = '';
      for (let i = 0; i <= text.length; i++) {
        placeholder.content = text.slice(0, i);
        renderMessages();
        await delay(5);
      }
    }

    // Initial paint
    renderMessages();
    autosize();
  </script>
</body>
</html>
